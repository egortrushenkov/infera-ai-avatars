# Инструкция и расчёт затрат на API

В проекте используются нейросетевые API для чата и озвучки. Ниже — что нужно для запуска и ориентировочные расходы.

---

## 1. Текущие API в проекте

| Сервис | Назначение | Стоимость |
|--------|------------|-----------|
| **OpenAI (GPT-4o-mini)** | Генерация ответов ассистента в чате | Платно, по токенам |
| **Web Speech API** | Озвучка ответов (TTS) в браузере | Бесплатно |
| **HeyGen / D-ID** (опционально) | Говорящее видео из фото (lip-sync) | Платно, по кредитам/минутам |

---

## 2. OpenAI API (чат)

### Модель

В проекте используется **GPT-4o-mini** (`openai/gpt-4o-mini` через Vercel AI SDK).

### Цены (актуально уточнять на [platform.openai.com/pricing](https://platform.openai.com/docs/pricing))

| Тип токенов | Цена за 1 млн токенов |
|-------------|----------------------|
| Input (вход) | **$0.15** |
| Output (выход) | **$0.60** |
| Cached input | $0.075 |

Ориентир: **1 токен ≈ 0.75 слова** для русского/английского; сообщение из 100 слов ≈ ~130 токенов.

### Что нужно для работы

1. Зарегистрироваться на [platform.openai.com](https://platform.openai.com).
2. Создать API-ключ в [API Keys](https://platform.openai.com/api-keys).
3. Положить ключ в переменную окружения:
   - Локально: в `.env.local`:
     ```env
     OPENAI_API_KEY=sk-...
     ```
   - На хостинге (Vercel и др.): в настройках проекта добавить `OPENAI_API_KEY`.
4. В коде ключ не хардкодить — только через `process.env.OPENAI_API_KEY` (уже используется при вызове через AI SDK).

### Ориентировочный расчёт затрат (OpenAI)

Допущения на **1 диалог**: запрос пользователя ~50 слов (≈65 input) + системный промпт ~80 токенов + ответ ассистента ~150 слов (≈200 output). Итого порядка **~350 input**, **~200 output** на один обмен.

| Пользователей в месяц | Диалогов на пользователя | Input (примерно) | Output (примерно) | Ориентировочная сумма в месяц |
|------------------------|---------------------------|------------------|-------------------|------------------------------|
| 100 | 20 | ~0.7M | ~0.4M | **~$0.11 + $0.24 ≈ $0.35** |
| 1 000 | 20 | ~7M | ~4M | **~$1.05 + $2.40 ≈ $3.45** |
| 10 000 | 15 | ~52M | ~30M | **~$7.80 + $18 ≈ $26** |

Формула:  
`input_cost = (пользователи × диалоги × 350 / 1_000_000) × 0.15`  
`output_cost = (пользователи × диалоги × 200 / 1_000_000) × 0.60`

Лимиты и уведомления можно настроить в [Billing → Limits](https://platform.openai.com/settings/organization/limits).

---

## 3. Web Speech API (озвучка)

- Встроен в браузер, **дополнительной платы нет**.
- Озвучка идёт на устройстве пользователя.
- Для продакшена стоит проверять поддержку (`speechSynthesis` в окне) и при отсутствии — не вызывать TTS или показывать подсказку.

Никаких ключей и расчётов по деньгам не требуется.

---

## 4. Опционально: говорящее видео (HeyGen / D-ID)

Если позже подключите «живое» видео аватара (фото + речь):

### HeyGen API

- **Тарифы:** [heygen.com/api-pricing](https://www.heygen.com/api-pricing)
- **Pro:** $99/мес — 100 кредитов (1 кредит = 1 минута видео).
- **Scale:** $330/мес — 660 кредитов (~$0.50 за минуту).
- **Real-time (LiveAvatar):** отдельные кредиты (например, 1 кредит = 30 сек стрима).

Ориентир при **100 пользователях**, 5 ответов с видео по 30 сек в месяц:  
100 × 5 × 0.5 мин = **250 минут** → нужен запас кредитов (Scale или выше), порядок **$125–330/мес** в зависимости от плана.

### D-ID API

- Тарифы: [d-id.com/pricing/api](https://www.d-id.com/pricing/api/)
- Сценарий: фото + текст/аудио → видео (до 5 мин). Точные цены — на сайте или у sales.

### Ограничение расхода (для любых платных API)

- Лимит на приложение: не больше N минут/кредитов в день или месяц (счётчик в БД/Redis).
- Лимит на пользователя: не больше K озвученных ответов в день.
- Включить «говорящее видео» только для платных пользователей или отключать при достижении бюджета.

---

## 5. Сводная таблица затрат (текущий проект без HeyGen/D-ID)

| Статья | 100 пользователей/мес | 1 000 пользователей/мес | 10 000 пользователей/мес |
|--------|------------------------|---------------------------|----------------------------|
| **OpenAI (GPT-4o-mini)** | ~$0.35 | ~$3.45 | ~$26 |
| **Web Speech (TTS)** | $0 | $0 | $0 |
| **Итого (без talking video)** | **~$0.35** | **~$3.45** | **~$26** |

При подключении HeyGen/D-ID добавятся расходы по их тарифам (см. выше).

---

## 6. Чек-лист перед запуском

- [ ] Добавлен `OPENAI_API_KEY` в окружение (локально и на сервере).
- [ ] В [OpenAI Billing](https://platform.openai.com/settings/organization/limits) выставлен месячный лимит и при необходимости — уведомления.
- [ ] При использовании HeyGen/D-ID — ключи в env, лимиты и счётчики на своей стороне (см. раздел 4).

Цены и лимиты API могут меняться — актуальные значения всегда смотрите на официальных страницах: [OpenAI Pricing](https://platform.openai.com/docs/pricing), [HeyGen API Pricing](https://www.heygen.com/api-pricing), [D-ID Pricing](https://www.d-id.com/pricing/api/).

---

## 7. Мобильная адаптация

Проект адаптирован под мобильные устройства:

- **Viewport:** `width=device-width`, `initial-scale=1`, `viewportFit=cover` для устройств с вырезами.
- **Safe area:** отступы `env(safe-area-inset-*)` учтены в `body`, контент не уходит под «челку» и индикатор жестов.
- **Высота экрана:** используется `100dvh` / `100svh` для корректной высоты на мобильных (без учёта панели браузера).
- **Кнопки и поля:** минимальная область нажатия ~44px по высоте, `touch-manipulation` для быстрого отклика.
- **Масштаб ввода:** у поля ввода задан `font-size: 16px`, чтобы на iOS не включалось авто-зумирование при фокусе.
- **Аватар и блок сообщений:** на маленьких экранах уменьшены отступы и размер аватара; список сообщений прокручивается с `overscroll-contain` и `touch-pan-y`.
